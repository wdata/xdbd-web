/*! squel | https://github.com/hiddentao/squel | BSD license */!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.squel=e()}(this,function(){"use strict";function t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){return t.length?t+e:t}function i(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];if(t&&n){var i=!0,o=!1,l=void 0;try{for(var a,u=function(){var e=a.value;"object"===("undefined"==typeof e?"undefined":d(e))&&Object.getOwnPropertyNames(e).forEach(function(n){t[n]=e[n]})},s=n[Symbol.iterator]();!(i=(a=s.next()).done);i=!0)u()}catch(c){o=!0,l=c}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw l}}}return t}function o(t){return t&&t.constructor.prototype===Object.prototype}function l(t){return t&&t.constructor.prototype===Array.prototype}function a(t){if(!t)return t;if("function"==typeof t.clone)return t.clone();if(!o(t)&&!l(t))return JSON.parse(JSON.stringify(t));var e=function(){var e=new t.constructor;return Object.getOwnPropertyNames(t).forEach(function(n){"function"!=typeof t[n]&&(e[n]=a(t[n]))}),{v:e}}();return"object"===("undefined"==typeof e?"undefined":d(e))?e.v:void 0}function u(t,e,n){var r="undefined"==typeof e?"undefined":d(e);if("function"!==r&&"string"!==r)throw new Error("type must be a class constructor or string");if("function"!=typeof n)throw new Error("handler must be a function");var i=!0,o=!1,l=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value;if(s.type===e)return void(s.handler=n)}}catch(c){o=!0,l=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw l}}t.push({type:e,handler:n})}function s(t,e,n){return c(t,e)||c(t,n)}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(("undefined"==typeof t?"undefined":d(t))===r.type||"string"!=typeof r.type&&t instanceof r.type)return r.handler}}function f(){var c=arguments.length<=0||void 0===arguments[0]?null:arguments[0],f={isSquelBuilder:function(t){return t&&!!t._toParamString}},p=function(t){return!f.isSquelBuilder(t)||!t.options.rawNesting};f.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" ",stringFormatter:null,rawNesting:!1},f.globalValueHandlers=[],f.registerValueHandler=function(t,e){u(f.globalValueHandlers,t,e)},f.Cloneable=function(){function t(){n(this,t)}return v(t,[{key:"clone",value:function(){var t=new this.constructor;return i(t,a(i({},this)))}}]),t}(),f.BaseBuilder=function(r){function o(e){n(this,o);var r=t(this,Object.getPrototypeOf(o).call(this)),l=JSON.parse(JSON.stringify(f.DefaultQueryBuilderOptions));return["stringFormatter"].forEach(function(t){l[t]=f.DefaultQueryBuilderOptions[t]}),r.options=i({},l,e),r}return e(o,r),v(o,[{key:"registerValueHandler",value:function(t,e){return u(this.options.valueHandlers,t,e),this}},{key:"_sanitizeExpression",value:function(t){if(!f.isSquelBuilder(t)&&"string"!=typeof t)throw new Error("expression must be a string or builder instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error(e+" must be a string");return t}},{key:"_sanitizeField",value:function(t){return f.isSquelBuilder(t)||(t=this._sanitizeName(t,"field name")),t}},{key:"_sanitizeBaseBuilder",value:function(t){if(f.isSquelBuilder(t))return t;throw new Error("must be a builder instance")}},{key:"_sanitizeTable",value:function(t){if("string"!=typeof t)try{t=this._sanitizeBaseBuilder(t)}catch(e){throw new Error("table name must be a string or a builder")}else t=this._sanitizeName(t,"table");return t}},{key:"_sanitizeTableAlias",value:function(t){return this._sanitizeName(t,"table alias")}},{key:"_sanitizeFieldAlias",value:function(t){return this._sanitizeName(t,"field alias")}},{key:"_sanitizeLimitOffset",value:function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e="undefined"==typeof t?"undefined":d(t);if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(f.isSquelBuilder(t));else{var n=!!s(t,this.options.valueHandlers,f.globalValueHandlers);if(!n)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatTableName",value:function(t){if(this.options.autoQuoteTableNames){var e=this.options.nameQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatFieldAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.fieldAliasQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatTableAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.tableAliasQuoteCharacter;t=""+e+t+e}return this.options.useAsForTableAliasNames?"AS "+t:t}},{key:"_formatFieldName",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.options.autoQuoteFieldNames&&!function(){var r=e.options.nameQuoteCharacter;t=n.ignorePeriodsForFieldNameQuotes?""+r+t+r:t.split(".").map(function(t){return"*"===t?t:""+r+t+r}).join(".")}(),t}},{key:"_formatCustomValue",value:function(t,e,n){var r=s(t,this.options.valueHandlers,f.globalValueHandlers);return r&&(t=r(t,e,n),t&&t.rawNesting)?{formatted:!0,rawNesting:!0,value:t.value}:{formatted:!!r,value:t}}},{key:"_formatValueForParamArray",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return l(t)?t.map(function(t){return e._formatValueForParamArray(t,n)}):this._formatCustomValue(t,!0,n).value}},{key:"_formatValueForQueryString",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=this._formatCustomValue(t,!1,n),i=r.rawNesting,o=r.formatted,a=r.value;if(o)return i?a:this._applyNestingFormatting(a,p(t));if(l(a))a=a.map(function(t){return e._formatValueForQueryString(t)}),a=this._applyNestingFormatting(a.join(", "),p(a));else{var u="undefined"==typeof a?"undefined":d(a);if(null===a)a="NULL";else if("boolean"===u)a=a?"TRUE":"FALSE";else if(f.isSquelBuilder(a))a=this._applyNestingFormatting(a.toString(),p(a));else if("number"!==u){if("string"===u&&this.options.stringFormatter)return this.options.stringFormatter(a);if(n.dontQuote)a=""+a;else{var s=this._escapeValue(a);a="'"+s+"'"}}}return a}},{key:"_applyNestingFormatting",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(t&&"string"==typeof t&&e&&!this.options.rawNesting){var n="("===t.charAt(0)&&")"===t.charAt(t.length-1);if(n)for(var r=0,i=1;t.length-1>++r;){var o=t.charAt(r);if("("===o)i++;else if(")"===o&&(i--,1>i)){n=!1;break}}n||(t="("+t+")")}return t}},{key:"_buildString",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=n.nested,i=n.buildParameterized,o=n.formattingOptions;e=e||[],t=t||"";for(var a="",u=-1,s=[],c=this.options.parameterCharacter,h=0;t.length>h;)if(t.substr(h,c.length)===c){var v=e[++u];if(i)if(f.isSquelBuilder(v)){var d=v._toParamString({buildParameterized:i,nested:!0});a+=d.text,d.values.forEach(function(t){return s.push(t)})}else if(v=this._formatValueForParamArray(v,o),l(v)){var p=v.map(function(){return c}).join(", ");a+="("+p+")",v.forEach(function(t){return s.push(t)})}else a+=c,s.push(v);else a+=this._formatValueForQueryString(v,o);h+=c.length}else a+=t.charAt(h),h++;return{text:this._applyNestingFormatting(a,!!r),values:s}}},{key:"_buildManyStrings",value:function(t,e){for(var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=[],i=[],o=0;t.length>o;++o){var l=t[o],a=e[o],u=this._buildString(l,a,{buildParameterized:n.buildParameterized,nested:!1}),s=u.text,c=u.values;r.push(s),c.forEach(function(t){return i.push(t)})}return r=r.join(this.options.separator),{text:r.length?this._applyNestingFormatting(r,!!n.nested):"",values:i}}},{key:"_toParamString",value:function(t){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(t).text}},{key:"toParam",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(i({},t,{buildParameterized:!0}))}}]),o}(f.Cloneable),f.Expression=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._nodes=[],r}return e(i,r),v(i,[{key:"and",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return t=this._sanitizeExpression(t),this._nodes.push({type:"AND",expr:t,para:n}),this}},{key:"or",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return t=this._sanitizeExpression(t),this._nodes.push({type:"OR",expr:t,para:n}),this}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=[],n=[],r=!0,i=!1,o=void 0;try{for(var l,a=this._nodes[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var u=l.value,s=u.type,c=u.expr,h=u.para,v=f.isSquelBuilder(c)?c._toParamString({buildParameterized:t.buildParameterized,nested:!0}):this._buildString(c,h,{buildParameterized:t.buildParameterized}),d=v.text,p=v.values;e.length&&e.push(s),e.push(d),p.forEach(function(t){return n.push(t)})}}catch(y){i=!0,o=y}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return e=e.join(" "),{text:this._applyNestingFormatting(e,!!t.nested),values:n}}}]),i}(f.BaseBuilder),f.Case=function(l){function a(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];n(this,a);var l=t(this,Object.getPrototypeOf(a).call(this,r));return o(e)&&(r=e,e=null),e&&(l._fieldName=l._sanitizeField(e)),l.options=i({},f.DefaultQueryBuilderOptions,r),l._cases=[],l._elseValue=null,l}return e(a,l),v(a,[{key:"when",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return this._cases.unshift({expression:t,values:n||[]}),this}},{key:"then",value:function(t){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}},{key:"else",value:function(t){return this._elseValue=t,this}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[],i=!0,o=!1,l=void 0;try{for(var a,u=this._cases[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=s.expression,f=s.values,h=s.result;e=r(e," ");var v=this._buildString(c,f,{buildParameterized:t.buildParameterized,nested:!0});e+="WHEN "+v.text+" THEN "+this._formatValueForQueryString(h),v.values.forEach(function(t){return n.push(t)})}}catch(d){o=!0,l=d}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw l}}return e.length?(e+=" ELSE "+this._formatValueForQueryString(this._elseValue)+" END",this._fieldName&&(e=this._fieldName+" "+e),e="CASE "+e):e=this._formatValueForQueryString(this._elseValue),{text:e,values:n}}}]),a}(f.BaseBuilder),f.Block=function(r){function i(e){return n(this,i),t(this,Object.getPrototypeOf(i).call(this,e))}return e(i,r),v(i,[{key:"exposedMethods",value:function(){for(var t={},e=this;e;)Object.getOwnPropertyNames(e).forEach(function(n){"constructor"===n||"function"!=typeof e[n]||"_"===n.charAt(0)||f.Block.prototype[n]||(t[n]=e[n])}),e=Object.getPrototypeOf(e);return t}}]),i}(f.BaseBuilder),f.StringBlock=function(r){function i(e,r){n(this,i);var o=t(this,Object.getPrototypeOf(i).call(this,e));return o._str=r,o}return e(i,r),v(i,[{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._str,values:[]}}}]),i}(f.Block),f.FunctionBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._strings=[],r._values=[],r}return e(i,r),v(i,[{key:"function",value:function(t){this._strings.push(t);for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];this._values.push(n)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._buildManyStrings(this._strings,this._values,t)}}]),i}(f.Block),f.registerValueHandler(f.FunctionBlock,function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return e?t.toParam():t.toString()}),f.AbstractTableBlock=function(i){function o(e,r){n(this,o);var i=t(this,Object.getPrototypeOf(o).call(this,e));return i._tables=[],i}return e(o,i),v(o,[{key:"_table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[];if(this._hasTable()){var i=!0,o=!1,l=void 0;try{for(var a,u=this._tables[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=s.table,h=s.alias;e=r(e,", ");var v=void 0;if(f.isSquelBuilder(c)){var d=c._toParamString({buildParameterized:t.buildParameterized,nested:!0}),p=d.text,y=d.values;v=p,y.forEach(function(t){return n.push(t)})}else v=this._formatTableName(c);h&&(v+=" "+this._formatTableAlias(h)),e+=v}}catch(g){o=!0,l=g}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw l}}this.options.prefix&&(e=this.options.prefix+" "+e)}return{text:e,values:n}}}]),o}(f.Block),f.TargetTableBlock=function(r){function i(){return n(this,i),t(this,Object.getPrototypeOf(i).apply(this,arguments))}return e(i,r),v(i,[{key:"target",value:function(t){this._table(t)}}]),i}(f.AbstractTableBlock),f.UpdateTableBlock=function(r){function i(){return n(this,i),t(this,Object.getPrototypeOf(i).apply(this,arguments))}return e(i,r),v(i,[{key:"table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("table() needs to be called");return h(Object.getPrototypeOf(i.prototype),"_toParamString",this).call(this,t)}}]),i}(f.AbstractTableBlock),f.FromTableBlock=function(r){function o(e){return n(this,o),t(this,Object.getPrototypeOf(o).call(this,i({},e,{prefix:"FROM"})))}return e(o,r),v(o,[{key:"from",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}}]),o}(f.AbstractTableBlock),f.IntoTableBlock=function(r){function o(e){return n(this,o),t(this,Object.getPrototypeOf(o).call(this,i({},e,{prefix:"INTO",singleTable:!0})))}return e(o,r),v(o,[{key:"into",value:function(t){this._table(t)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("into() needs to be called");return h(Object.getPrototypeOf(o.prototype),"_toParamString",this).call(this,t)}}]),o}(f.AbstractTableBlock),f.GetFieldBlock=function(i){function o(e){n(this,o);var r=t(this,Object.getPrototypeOf(o).call(this,e));return r._fields=[],r}return e(o,i),v(o,[{key:"fields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(l(t)){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value;this.field(u,null,e)}}catch(s){r=!0,i=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw i}}}else for(var c in t){var f=t[c];this.field(c,f,e)}}},{key:"field",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);var r=this._fields.filter(function(n){return n.name===t&&n.alias===e});return r.length?this:void this._fields.push({name:t,alias:e,options:n})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.queryBuilder,n=t.buildParameterized,i="",o=[],l=!0,a=!1,u=void 0;try{for(var s,c=this._fields[Symbol.iterator]();!(l=(s=c.next()).done);l=!0){var h=s.value;i=r(i,", ");var v=h.name,d=h.alias,p=h.options;if("string"==typeof v)i+=this._formatFieldName(v,p);else{var y=v._toParamString({nested:!0,buildParameterized:n});i+=y.text,y.values.forEach(function(t){return o.push(t)})}d&&(i+=" AS "+this._formatFieldAlias(d))}}catch(g){a=!0,u=g}finally{try{!l&&c["return"]&&c["return"]()}finally{if(a)throw u}}if(!i.length){var _=e&&e.getBlock(f.FromTableBlock);_&&_._hasTable()&&(i="*")}return{text:i,values:o}}}]),o}(f.Block),f.AbstractSetFieldBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._reset(),r}return e(i,r),v(i,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(this._values.length>1)throw new Error("Cannot set multiple rows of fields this way.");"undefined"!=typeof e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);var r=this._fields.indexOf(t);-1===r&&(this._fields.push(t),r=this._fields.length-1),this._values[0][r]=e,this._valueOptions[0][r]=n}},{key:"_setFields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof t?"undefined":d(t)))throw new Error("Expected an object but got "+("undefined"==typeof t?"undefined":d(t)));for(var n in t)this._set(n,t[n],e)}},{key:"_setFieldsRows",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!l(t))throw new Error("Expected an array of objects but got "+("undefined"==typeof t?"undefined":d(t)));this._reset();for(var n=0;t.length>n;++n){var r=t[n];for(var i in r){var o=r[i];i=this._sanitizeField(i),o=this._sanitizeValue(o);var a=this._fields.indexOf(i);if(n>0&&-1===a)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===a&&(this._fields.push(i),a=this._fields.length-1),l(this._values[n])||(this._values[n]=[],this._valueOptions[n]=[]),this._values[n][a]=o,this._valueOptions[n][a]=e}}}}]),i}(f.Block),f.SetFieldBlock=function(i){function o(){return n(this,o),t(this,Object.getPrototypeOf(o).apply(this,arguments))}return e(o,i),v(o,[{key:"set",value:function(t,e,n){this._set(t,e,n)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.buildParameterized;if(0>=this._fields.length)throw new Error("set() needs to be called");for(var n="",i=[],o=0;o<this._fields.length;++o){n=r(n,", ");var l=this._formatFieldName(this._fields[o]),a=this._values[0][o];0>l.indexOf("=")&&(l=l+" = "+this.options.parameterCharacter);var u=this._buildString(l,[a],{buildParameterized:e,formattingOptions:this._valueOptions[0][o]});n+=u.text,u.values.forEach(function(t){return i.push(t)})}return{text:"SET "+n,values:i}}}]),o}(f.AbstractSetFieldBlock),f.InsertFieldValueBlock=function(i){function o(){return n(this,o),t(this,Object.getPrototypeOf(o).apply(this,arguments))}return e(o,i),v(o,[{key:"set",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this._set(t,e,n)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_toParamString",value:function(){for(var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=e.buildParameterized,i=this._fields.map(function(e){return t._formatFieldName(e)}).join(", "),o=[],l=[],a=0;a<this._values.length;++a){o[a]="";for(var u=0;u<this._values[a].length;++u){var s=this._buildString(this.options.parameterCharacter,[this._values[a][u]],{buildParameterized:n,formattingOptions:this._valueOptions[a][u]});s.values.forEach(function(t){return l.push(t)}),o[a]=r(o[a],", "),o[a]+=s.text}}return{text:i.length?"("+i+") VALUES ("+o.join("), (")+")":"",values:l}}}]),o}(f.AbstractSetFieldBlock),f.InsertFieldsFromQueryBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._fields=[],r._query=null,r}return e(i,r),v(i,[{key:"fromQuery",value:function(t,e){var n=this;this._fields=t.map(function(t){return n._sanitizeField(t)}),this._query=this._sanitizeBaseBuilder(e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[];if(this._fields.length&&this._query){var r=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0}),i=r.text,o=r.values;e="("+this._fields.join(", ")+") "+this._applyNestingFormatting(i),n=o}return{text:e,values:n}}}]),i}(f.Block),f.DistinctBlock=function(r){function i(){return n(this,i),t(this,Object.getPrototypeOf(i).apply(this,arguments))}return e(i,r),v(i,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),i}(f.Block),f.GroupByBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._groups=[],r}return e(i,r),v(i,[{key:"group",value:function(t){this._groups.push(this._sanitizeField(t))}},{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._groups.length?"GROUP BY "+this._groups.join(", "):"",values:[]}}}]),i}(f.Block),f.AbstractVerbSingleValueBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._value=null,r}return e(i,r),v(i,[{key:"_setValue",value:function(t){this._value=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=null!==this._value?this.options.verb+" "+this.options.parameterCharacter:"",n=null!==this._value?[this._value]:[];return this._buildString(e,n,t)}}]),i}(f.Block),f.OffsetBlock=function(r){function o(e){return n(this,o),t(this,Object.getPrototypeOf(o).call(this,i({},e,{verb:"OFFSET"})))}return e(o,r),v(o,[{key:"offset",value:function(t){this._setValue(t)}}]),o}(f.AbstractVerbSingleValueBlock),f.LimitBlock=function(r){function o(e){return n(this,o),t(this,Object.getPrototypeOf(o).call(this,i({},e,{verb:"LIMIT"})))}return e(o,r),v(o,[{key:"limit",value:function(t){this._setValue(t)}}]),o}(f.AbstractVerbSingleValueBlock),f.AbstractConditionBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._conditions=[],r}return e(i,r),v(i,[{key:"_condition",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];this._conditions.push({expr:t,values:n||[]})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=[],n=[],r=!0,i=!1,o=void 0;try{for(var l,a=this._conditions[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var u=l.value,s=u.expr,c=u.values,h=f.isSquelBuilder(s)?s._toParamString({buildParameterized:t.buildParameterized}):this._buildString(s,c,{buildParameterized:t.buildParameterized});h.text.length&&e.push(h.text),h.values.forEach(function(t){return n.push(t)})}}catch(v){i=!0,o=v}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return e.length&&(e=e.join(") AND (")),{text:e.length?this.options.verb+" ("+e+")":"",values:n}}}]),i}(f.Block),f.WhereBlock=function(r){function o(e){return n(this,o),t(this,Object.getPrototypeOf(o).call(this,i({},e,{verb:"WHERE"})))}return e(o,r),v(o,[{key:"where",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];this._condition.apply(this,[t].concat(n))}}]),o}(f.AbstractConditionBlock),f.HavingBlock=function(r){function o(e){return n(this,o),t(this,Object.getPrototypeOf(o).call(this,i({},e,{verb:"HAVING"})))}return e(o,r),v(o,[{key:"having",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];this._condition.apply(this,[t].concat(n))}}]),o}(f.AbstractConditionBlock),f.OrderByBlock=function(i){function o(e){n(this,o);var r=t(this,Object.getPrototypeOf(o).call(this,e));return r._orders=[],r}return e(o,i),v(o,[{key:"order",value:function(t,e){t=this._sanitizeField(t),"string"!=typeof e&&(void 0===e?e="ASC":null!==e&&(e=e?"ASC":"DESC"));for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;n>i;i++)r[i-2]=arguments[i];this._orders.push({field:t,dir:e,values:r||[]})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[],i=!0,o=!1,a=void 0;try{for(var u,s=this._orders[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value,f=c.field,h=c.dir,v=c.values;e=r(e,", ");var d=this._buildString(f,v,{buildParameterized:t.buildParameterized});e+=d.text,l(d.values)&&d.values.forEach(function(t){return n.push(t)}),null!==h&&(e+=" "+h)}}catch(p){o=!0,a=p}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw a}}return{text:e.length?"ORDER BY "+e:"",values:n}}}]),o}(f.Block),f.JoinBlock=function(i){function o(e){n(this,o);var r=t(this,Object.getPrototypeOf(o).call(this,e));return r._joins=[],r}return e(o,i),v(o,[{key:"join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=arguments.length<=3||void 0===arguments[3]?"INNER":arguments[3];t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,n=n?this._sanitizeExpression(n):n,this._joins.push({type:r,table:t,alias:e,condition:n})}},{key:"left_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,n,"LEFT")}},{key:"right_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,n,"RIGHT")}},{key:"outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,n,"OUTER")}},{key:"left_outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,n,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,n,"FULL")}},{key:"cross_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,n,"CROSS")}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[],i=!0,o=!1,l=void 0;try{for(var a,u=this._joins[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=s.type,h=s.table,v=s.alias,d=s.condition;e=r(e,this.options.separator);var p=void 0;if(f.isSquelBuilder(h)){var y=h._toParamString({buildParameterized:t.buildParameterized,nested:!0});y.values.forEach(function(t){return n.push(t)}),p=y.text}else p=this._formatTableName(h);if(e+=c+" JOIN "+p,v&&(e+=" "+this._formatTableAlias(v)),d){e+=" ON ";var g=void 0;g=f.isSquelBuilder(d)?d._toParamString({buildParameterized:t.buildParameterized}):this._buildString(d,[],{buildParameterized:t.buildParameterized}),e+=this._applyNestingFormatting(g.text),g.values.forEach(function(t){return n.push(t)})}}}catch(_){o=!0,l=_}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw l}}return{text:e,values:n}}}]),o}(f.Block),f.UnionBlock=function(i){function o(e){n(this,o);var r=t(this,Object.getPrototypeOf(o).call(this,e));return r._unions=[],r}return e(o,i),v(o,[{key:"union",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"UNION":arguments[1];t=this._sanitizeTable(t),this._unions.push({type:e,table:t})}},{key:"union_all",value:function(t){this.union(t,"UNION ALL")}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[],i=!0,o=!1,l=void 0;try{for(var a,u=this._unions[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=s.type,h=s.table;e=r(e,this.options.separator);var v=void 0;if(h instanceof f.BaseBuilder){var d=h._toParamString({buildParameterized:t.buildParameterized,nested:!0});v=d.text,d.values.forEach(function(t){return n.push(t)})}else e=this._formatTableName(h);e+=c+" "+v}}catch(p){o=!0,l=p}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw l}}return{text:e,values:n}}}]),o}(f.Block),f.QueryBuilder=function(r){function o(e,r){n(this,o);var i=t(this,Object.getPrototypeOf(o).call(this,e));i.blocks=r||[];var l=!0,a=!1,u=void 0;try{for(var s,c=i.blocks[Symbol.iterator]();!(l=(s=c.next()).done);l=!0){var f=s.value,h=f.exposedMethods();for(var v in h){var d=h[v];if(void 0!==i[v])throw new Error("Builder already has a builder method called: "+v);!function(t,e,n){i[e]=function(){for(var e=arguments.length,r=Array(e),o=0;e>o;o++)r[o]=arguments[o];return n.call.apply(n,[t].concat(r)),i}}(f,v,d)}}}catch(p){a=!0,u=p}finally{try{!l&&c["return"]&&c["return"]()}finally{if(a)throw u}}return i}return e(o,r),v(o,[{key:"registerValueHandler",value:function(t,e){var n=!0,r=!1,i=void 0;try{for(var l,a=this.blocks[Symbol.iterator]();!(n=(l=a.next()).done);n=!0){var u=l.value;u.registerValueHandler(t,e)}}catch(s){r=!0,i=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw i}}return h(Object.getPrototypeOf(o.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(t){this.options=i({},this.options,t);var e=!0,n=!1,r=void 0;try{for(var o,l=this.blocks[Symbol.iterator]();!(e=(o=l.next()).done);e=!0){var a=o.value;a.options=i({},a.options,t)}}catch(u){n=!0,r=u}finally{try{!e&&l["return"]&&l["return"]()}finally{if(n)throw r}}}},{key:"_toParamString",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e=i({},this.options,e);var n=this.blocks.map(function(n){return n._toParamString({buildParameterized:e.buildParameterized,queryBuilder:t})}),r=n.map(function(t){return t.text}),o=n.map(function(t){return t.values}),l=r.filter(function(t){return 0<t.length}).join(e.separator),a=[];return o.forEach(function(t){return t.forEach(function(t){return a.push(t)})}),e.nested||e.numberedParameters&&!function(){var t=void 0!==e.numberedParametersStartAt?e.numberedParametersStartAt:1,n=e.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");l=l.replace(new RegExp(n,"g"),function(){return""+e.numberedParametersPrefix+t++})}(),{text:this._applyNestingFormatting(l,!!e.nested),values:a}}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"getBlock",value:function(t){var e=this.blocks.filter(function(e){return e instanceof t});return e[0]}}]),o}(f.BaseBuilder),f.Select=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new f.StringBlock(e,"SELECT"),new f.FunctionBlock(e),new f.DistinctBlock(e),new f.GetFieldBlock(e),new f.FromTableBlock(e),new f.JoinBlock(e),new f.WhereBlock(e),new f.GroupByBlock(e),new f.HavingBlock(e),new f.OrderByBlock(e),new f.LimitBlock(e),new f.OffsetBlock(e),new f.UnionBlock(e)],
t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(f.QueryBuilder),f.Update=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new f.StringBlock(e,"UPDATE"),new f.UpdateTableBlock(e),new f.SetFieldBlock(e),new f.WhereBlock(e),new f.OrderByBlock(e),new f.LimitBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(f.QueryBuilder),f.Delete=function(r){function o(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,o),r=r||[new f.StringBlock(e,"DELETE"),new f.TargetTableBlock(e),new f.FromTableBlock(i({},e,{singleTable:!0})),new f.JoinBlock(e),new f.WhereBlock(e),new f.OrderByBlock(e),new f.LimitBlock(e)],t(this,Object.getPrototypeOf(o).call(this,e,r))}return e(o,r),o}(f.QueryBuilder),f.Insert=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new f.StringBlock(e,"INSERT"),new f.IntoTableBlock(e),new f.InsertFieldValueBlock(e),new f.InsertFieldsFromQueryBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(f.QueryBuilder);var y={VERSION:"5.11.1",flavour:c,expr:function(t){return new f.Expression(t)},"case":function(t,e){return new f.Case(t,e)},select:function(t,e){return new f.Select(t,e)},update:function(t,e){return new f.Update(t,e)},insert:function(t,e){return new f.Insert(t,e)},"delete":function(t,e){return new f.Delete(t,e)},str:function(){var t=new f.FunctionBlock;return t["function"].apply(t,arguments),t},rstr:function(){var t=new f.FunctionBlock({rawNesting:!0});return t["function"].apply(t,arguments),t},registerValueHandler:f.registerValueHandler};return y.remove=y["delete"],y.cls=f,y}var h=function y(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:y(i,e,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},v=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},p=f();return p.flavours={},p.useFlavour=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(!t)return p;if(p.flavours[t]instanceof Function){var e=f(t);return p.flavours[t].call(null,e),e.flavours=p.flavours,e.useFlavour=p.useFlavour,e}throw new Error("Flavour not available: "+t)},p.flavours.mssql=function(o){var l=o.cls;l.DefaultQueryBuilderOptions.replaceSingleQuotes=!0,l.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,l.DefaultQueryBuilderOptions.numberedParametersPrefix="@",o.registerValueHandler(Date,function(t){return"'"+t.getUTCFullYear()+"-"+(t.getUTCMonth()+1)+"-"+t.getUTCDate()+" "+t.getUTCHours()+":"+t.getUTCMinutes()+":"+t.getUTCSeconds()+"'"}),l.MssqlLimitOffsetTopBlock=function(r){function i(r){n(this,i);var o=t(this,Object.getPrototypeOf(i).call(this,r));o._limits=null,o._offsets=null;var a=function(t){t=this._sanitizeLimitOffset(t),this._parent._limits=t};return o.ParentBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e.options));return r._parent=e,r}return e(i,r),i}(l.Block),o.LimitBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r.limit=a,r}return e(i,r),v(i,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&this._parent._offsets&&(t="FETCH NEXT "+this._parent._limits+" ROWS ONLY"),{text:t,values:[]}}}]),i}(o.ParentBlock),o.TopBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r.top=a,r}return e(i,r),v(i,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&!this._parent._offsets&&(t="TOP ("+this._parent._limits+")"),{text:t,values:[]}}}]),i}(o.ParentBlock),o.OffsetBlock=function(r){function i(){return n(this,i),t(this,Object.getPrototypeOf(i).apply(this,arguments))}return e(i,r),v(i,[{key:"offset",value:function(t){this._parent._offsets=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t="";return this._parent._offsets&&(t="OFFSET "+this._parent._offsets+" ROWS"),{text:t,values:[]}}}]),i}(o.ParentBlock),o}return e(i,r),v(i,[{key:"LIMIT",value:function(){return new this.LimitBlock(this)}},{key:"TOP",value:function(){return new this.TopBlock(this)}},{key:"OFFSET",value:function(){return new this.OffsetBlock(this)}}]),i}(l.Block),l.MssqlUpdateTopBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._limits=null,r.limit=r.top=function(t){r._limits=r._sanitizeLimitOffset(t)},r}return e(i,r),v(i,[{key:"_toParamString",value:function(){return{text:this._limits?"TOP ("+this._limits+")":"",values:[]}}}]),i}(l.Block),l.MssqlInsertFieldValueBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._outputs=[],r}return e(i,r),v(i,[{key:"output",value:function(t){var e=this;"string"==typeof t?this._outputs.push("INSERTED."+this._sanitizeField(t)):t.forEach(function(t){e._outputs.push("INSERTED."+e._sanitizeField(t))})}},{key:"_toParamString",value:function(t){var e=h(Object.getPrototypeOf(i.prototype),"_toParamString",this).call(this,t);if(e.text.length&&0<this._outputs.length){var n="OUTPUT "+this._outputs.join(", ")+" ",r=e.text.indexOf("VALUES");e.text=e.text.substr(0,r)+n+e.text.substr(r)}return e}}]),i}(l.InsertFieldValueBlock),l.MssqlUpdateDeleteOutputBlock=function(i){function o(e){n(this,o);var r=t(this,Object.getPrototypeOf(o).call(this,e));return r._outputs=[],r}return e(o,i),v(o,[{key:"outputs",value:function(t){for(var e in t)this.output(e,t[e])}},{key:"output",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];t=this._sanitizeField(t),e=e?this._sanitizeFieldAlias(e):e,this._outputs.push({name:this.options.forDelete?"DELETED."+t:"INSERTED."+t,alias:e})}},{key:"_toParamString",value:function(t){var e="";if(this._outputs.length){var n=!0,i=!1,o=void 0;try{for(var l,a=this._outputs[Symbol.iterator]();!(n=(l=a.next()).done);n=!0){var u=l.value;e=r(e,", "),e+=u.name,u.alias&&(e+=" AS "+this._formatFieldAlias(u.alias))}}catch(s){i=!0,o=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}e="OUTPUT "+e}return{text:e,values:[]}}}]),o}(l.Block),l.Select=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];n(this,i);var o=new l.MssqlLimitOffsetTopBlock(e);return r=r||[new l.StringBlock(e,"SELECT"),new l.DistinctBlock(e),o.TOP(),new l.GetFieldBlock(e),new l.FromTableBlock(e),new l.JoinBlock(e),new l.WhereBlock(e),new l.GroupByBlock(e),new l.OrderByBlock(e),o.OFFSET(),o.LIMIT(),new l.UnionBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(l.QueryBuilder),l.Update=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new l.StringBlock(e,"UPDATE"),new l.MssqlUpdateTopBlock(e),new l.UpdateTableBlock(e),new l.SetFieldBlock(e),new l.MssqlUpdateDeleteOutputBlock(e),new l.WhereBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(l.QueryBuilder),l.Delete=function(r){function o(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,o),r=r||[new l.StringBlock(e,"DELETE"),new l.TargetTableBlock(e),new l.FromTableBlock(i({},e,{singleTable:!0})),new l.JoinBlock(e),new l.MssqlUpdateDeleteOutputBlock(i({},e,{forDelete:!0})),new l.WhereBlock(e),new l.OrderByBlock(e),new l.LimitBlock(e)],t(this,Object.getPrototypeOf(o).call(this,e,r))}return e(o,r),o}(l.QueryBuilder),l.Insert=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new l.StringBlock(e,"INSERT"),new l.IntoTableBlock(e),new l.MssqlInsertFieldValueBlock(e),new l.InsertFieldsFromQueryBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(l.QueryBuilder)},p.flavours.mysql=function(i){var o=i.cls;o.MysqlOnDuplicateKeyUpdateBlock=function(i){function o(){return n(this,o),t(this,Object.getPrototypeOf(o).apply(this,arguments))}return e(o,i),v(o,[{key:"onDupUpdate",value:function(t,e,n){this._set(t,e,n)}},{key:"_toParamString",value:function(){for(var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[],i=0;i<this._fields.length;++i){e=r(e,", ");var o=this._fields[i],l=this._values[0][i],a=this._valueOptions[0][i];if("undefined"==typeof l)e+=o;else{var u=this._buildString(o+" = "+this.options.parameterCharacter,[l],{buildParameterized:t.buildParameterized,formattingOptions:a});e+=u.text,u.values.forEach(function(t){return n.push(t)})}}return{text:e.length?"ON DUPLICATE KEY UPDATE "+e:"",values:n}}}]),o}(o.AbstractSetFieldBlock),o.Insert=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new o.StringBlock(e,"INSERT"),new o.IntoTableBlock(e),new o.InsertFieldValueBlock(e),new o.InsertFieldsFromQueryBlock(e),new o.MysqlOnDuplicateKeyUpdateBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(o.QueryBuilder),o.Replace=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new o.StringBlock(e,"REPLACE"),new o.IntoTableBlock(e),new o.InsertFieldValueBlock(e),new o.InsertFieldsFromQueryBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(o.QueryBuilder),i.replace=function(t,e){return new o.Replace(t,e)}},p.flavours.postgres=function(o){var a=o.cls;a.DefaultQueryBuilderOptions.numberedParameters=!0,a.DefaultQueryBuilderOptions.numberedParametersStartAt=1,a.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,a.DefaultQueryBuilderOptions.useAsForTableAliasNames=!0,a.PostgresOnConflictKeyUpdateBlock=function(i){function o(){return n(this,o),t(this,Object.getPrototypeOf(o).apply(this,arguments))}return e(o,i),v(o,[{key:"onConflict",value:function(t,e){var n=this;this._onConflict=!0,t&&(l(t)||(t=[t]),this._dupFields=t.map(this._sanitizeField.bind(this)),e&&Object.keys(e).forEach(function(t){n._set(t,e[t])}))}},{key:"_toParamString",value:function(){for(var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",n=[],i=0;i<this._fields.length;++i){e=r(e,", ");var o=this._fields[i],l=this._values[0][i],a=this._valueOptions[0][i];if("undefined"==typeof l)e+=o;else{var u=this._buildString(o+" = "+this.options.parameterCharacter,[l],{buildParameterized:t.buildParameterized,formattingOptions:a});e+=u.text,u.values.forEach(function(t){return n.push(t)})}}var s={text:"",values:n};if(this._onConflict){var c=this._dupFields?"("+this._dupFields.join(", ")+") ":"",f=e.length?"UPDATE SET "+e:"NOTHING";s.text="ON CONFLICT "+c+"DO "+f}return s}}]),o}(a.AbstractSetFieldBlock),a.ReturningBlock=function(i){function o(e){n(this,o);var r=t(this,Object.getPrototypeOf(o).call(this,e));return r._fields=[],r}return e(o,i),v(o,[{key:"returning",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);var r=this._fields.filter(function(n){return n.name===t&&n.alias===e});return r.length?this:void this._fields.push({name:t,alias:e,options:n})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=(t.queryBuilder,t.buildParameterized),n="",i=[],o=!0,l=!1,a=void 0;try{for(var u,s=this._fields[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;n=r(n,", ");var f=c.name,h=c.alias,v=c.options;if("string"==typeof f)n+=this._formatFieldName(f,v);else{var d=f._toParamString({nested:!0,buildParameterized:e});n+=d.text,d.values.forEach(function(t){return i.push(t)})}h&&(n+=" AS "+this._formatFieldAlias(h))}}catch(p){l=!0,a=p}finally{try{!o&&s["return"]&&s["return"]()}finally{if(l)throw a}}return{text:n.length>0?"RETURNING "+n:"",values:i}}}]),o}(a.Block),a.WithBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._tables=[],r}return e(i,r),v(i,[{key:"with",value:function(t,e){this._tables.push({alias:t,table:e})}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=[],n=[],r=!0,i=!1,o=void 0;try{for(var l,a=this._tables[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var u=l.value,s=u.alias,c=u.table,f=c._toParamString({buildParameterized:t.buildParameterized,nested:!0});e.push(s+" AS "+f.text),f.values.forEach(function(t){return n.push(t)})}}catch(h){i=!0,o=h}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return{text:e.length?"WITH "+e.join(", "):"",values:n}}}]),i}(a.Block),a.DistinctOnBlock=function(r){function i(e){n(this,i);var r=t(this,Object.getPrototypeOf(i).call(this,e));return r._distinctFields=[],r}return e(i,r),v(i,[{key:"distinct",value:function(){var t=this;this._useDistinct=!0;for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];n.forEach(function(e){t._distinctFields.push(t._sanitizeField(e))})}},{key:"_toParamString",value:function(){var t="";return this._useDistinct&&(t="DISTINCT",this._distinctFields.length&&(t+=" ON ("+this._distinctFields.join(", ")+")")),{text:t,values:[]}}}]),i}(a.Block),a.Select=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new a.WithBlock(e),new a.StringBlock(e,"SELECT"),new a.FunctionBlock(e),new a.DistinctOnBlock(e),new a.GetFieldBlock(e),new a.FromTableBlock(e),new a.JoinBlock(e),new a.WhereBlock(e),new a.GroupByBlock(e),new a.HavingBlock(e),new a.OrderByBlock(e),new a.LimitBlock(e),new a.OffsetBlock(e),new a.UnionBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(a.QueryBuilder),a.Insert=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new a.WithBlock(e),new a.StringBlock(e,"INSERT"),new a.IntoTableBlock(e),new a.InsertFieldValueBlock(e),new a.InsertFieldsFromQueryBlock(e),new a.PostgresOnConflictKeyUpdateBlock(e),new a.ReturningBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(a.QueryBuilder),a.Update=function(r){function i(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new a.WithBlock(e),new a.StringBlock(e,"UPDATE"),new a.UpdateTableBlock(e),new a.SetFieldBlock(e),new a.FromTableBlock(e),new a.WhereBlock(e),new a.OrderByBlock(e),new a.LimitBlock(e),new a.ReturningBlock(e)],t(this,Object.getPrototypeOf(i).call(this,e,r))}return e(i,r),i}(a.QueryBuilder),a.Delete=function(r){function o(e){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,o),r=r||[new a.WithBlock(e),new a.StringBlock(e,"DELETE"),new a.TargetTableBlock(e),new a.FromTableBlock(i({},e,{singleTable:!0})),new a.JoinBlock(e),new a.WhereBlock(e),new a.OrderByBlock(e),new a.LimitBlock(e),new a.ReturningBlock(e)],t(this,Object.getPrototypeOf(o).call(this,e,r))}return e(o,r),o}(a.QueryBuilder)},p});